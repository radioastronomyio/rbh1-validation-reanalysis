<!--
---
title: "Phase 02 Validation Plots"
description: "Diagnostic visualizations for RBH-1 ETL validation"
author: "CrainBramp / VintageDon"
date: "2024-12-24"
version: "1.0"
status: "Complete"
phase: phase-02
tags:
  - domain: visualization
  - type: validation
  - type: qa
related_documents:
  - "[Phase 02 README](../README.md)"
  - "[Visualization Script](../07-visualize_data_phase_02.py)"
---
-->

# Phase 02 Validation Plots

Diagnostic visualizations generated from Zone 0/1 database tables to validate ETL correctness.

## Purpose

These plots serve three functions:

1. ETL Validation: Confirm that WCS geometry and spectral calibration data were correctly ingested
2. Sanity Checks: Catch malformed footprints, coordinate errors, or wavelength anomalies
3. Documentation: Provide visual evidence for the validation paper methodology section

## Generation

Plots are generated by `07-visualize_data_phase_02.py`:

```bash
cd /mnt/ai-ml/rbh1/phase02
python 07-visualize_data_phase_02.py --outdir ./plots --standalone --format png
```

Data Sources:

- `rbh1.observations` — file metadata
- `rbh1.wcs_solutions` — WCS parameters and PostGIS footprints
- `rbh1.spectral_grids` — wavelength arrays for JWST s3d cubes

---

## Plot Inventory

### Dashboard

| File | Description |
|------|-------------|
| `phase02_validation_dashboard.png` | 2×3 panel summary of all validation metrics |

The dashboard is the primary validation artifact and is embedded in the [Phase 02 README](../README.md).

### Standalone Plots

| File | Description |
|------|-------------|
| `phase02_footprints.png` | WCS footprint overlay with zoom inset |
| `phase02_span_regimes.png` | Footprint size scatter (log-log) |
| `phase02_lambda_vs_channel.png` | Wavelength vs channel index |
| `phase02_Rgrid_vs_lambda.png` | Sampling resolution vs wavelength |

---

## Panel Reference

### Panel 1: WCS Footprint Overlay

Query:

```sql
SELECT o.filename, o.file_type, ST_AsText(w.footprint) AS footprint_wkt
FROM rbh1.wcs_solutions w
JOIN rbh1.observations o ON o.obs_id = w.obs_id;
```

Validation target: All footprints in correct sky region, IFU inside HST coverage.

### Panel 2: Footprint Span Regimes

Query:

```sql
SELECT o.filename, o.file_type,
       (ST_XMax(w.footprint)-ST_XMin(w.footprint))*3600 AS dra_arcsec,
       (ST_YMax(w.footprint)-ST_YMin(w.footprint))*3600 AS ddec_arcsec
FROM rbh1.wcs_solutions w
JOIN rbh1.observations o ON o.obs_id = w.obs_id;
```

Validation target: Three distinct regimes (IFU ~6", HST ~100-300", skycell ~700-900").

### Panel 3: Pointing Coherence

Query:

```sql
SELECT o.filename, o.file_type, w.crval1, w.crval2
FROM rbh1.wcs_solutions w
JOIN rbh1.observations o ON o.obs_id = w.obs_id;
```

Validation target: Science pointings clustered, skycells as labeled outliers.

### Panel 4: Pixel Scale Distribution

Query:

```sql
SELECT o.file_type, w.cd1_1, w.cd1_2, w.cd2_1, w.cd2_2
FROM rbh1.wcs_solutions w
JOIN rbh1.observations o ON o.obs_id = w.obs_id;
```

Derived: `pixscale = 0.5 * (hypot(cd1_1, cd2_1) + hypot(cd1_2, cd2_2)) * 3600`

Validation target: HST ~0.04"/pix, JWST ~0.10"/pix, no outliers.

### Panel 5: Wavelength Grid Spacing

Query:

```sql
SELECT g.wavelength_array
FROM rbh1.spectral_grids g
JOIN rbh1.wcs_solutions w ON w.wcs_id = g.wcs_id
JOIN rbh1.observations o ON o.obs_id = w.obs_id
WHERE o.file_type = 's3d'
LIMIT 1;
```

Derived: `Δλ = diff(wavelength_array)`

Validation target: Near-constant spacing ~0.636 nm across bandpass.

### Panel 6: Sampling Resolution

Derived: `R = λ / Δλ`

Validation target: R increases with λ (constant Δλ behavior), mean ~2249.

---

## Key Findings

1. Footprint geometry is correct: All observations target RBH-1 field at RA ~40.45°, Dec ~-8.35°
2. Scale separation is clean: Three instrument regimes clearly distinguished
3. Skycells are not pointing errors: HAP mosaics have different reference pixels, explaining CRVAL offsets
4. Wavelength grids are identical: All 18 s3d cubes share the same wavelength solution (hash: `0839c17f...`)
5. No malformed WCS: Zero invalid PostGIS geometries, no pixel-scale outliers

---

## Regeneration

To regenerate after schema changes or ETL reruns:

```bash
# Remove old plots
rm -f plots/*.png

# Regenerate
python 07-validation-visualizations.py --outdir ./plots --standalone --format png
```

For PDF output (publication quality):

```bash
python 07-visualize_data_phase_02.py --outdir ./plots --standalone --format pdf
```

---
